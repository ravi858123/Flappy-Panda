<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Flappy Panda ğŸ¼</title>
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#87CEEB;overflow:hidden}
canvas{display:block}
.screen{
position:fixed;inset:0;
display:flex;flex-direction:column;
justify-content:center;align-items:center;
background:rgba(0,0,0,.65);
color:white;z-index:10}
button{padding:12px 24px;margin:6px;font-size:16px;border-radius:10px;border:none}
.card{background:white;color:black;padding:12px;border-radius:12px;margin:6px;width:240px}
#hud{position:fixed;top:10px;left:10px;font-size:18px;color:white}
#leaderboard{margin-top:10px;background:#111;padding:10px;border-radius:10px}
</style>
</head>
<body>

<div id="menu" class="screen">
<h1>Flappy Panda ğŸ¼</h1>
<p>Coins: <span id="coins">0</span></p>
<button onclick="startGame()">Start</button>
<button onclick="openShop()">Shop</button>
<div id="leaderboard">
<h3>ğŸŒ Global Highscores</h3>
<ol id="scores"></ol>
</div>
</div>

<div id="shop" class="screen" style="display:none">
<h2>ğŸ›’ Shop</h2>
<div id="shopList"></div>
<button onclick="backToMenu()">Back</button>
</div>

<div id="gameover" class="screen" style="display:none">
<h2>Game Over</h2>
<p>Score: <span id="finalScore">0</span></p>
<button onclick="startGame()">Restart</button>
<button onclick="backToMenu()">Menu</button>
</div>

<div id="hud">Score: <span id="score">0</span></div>
<canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
window.addEventListener("resize",resize);resize();

const SKINS=[
{emoji:"ğŸ¼",cost:0},{emoji:"ğŸµ",cost:10},{emoji:"ğŸ¸",cost:15},
{emoji:"ğŸ§",cost:20},{emoji:"ğŸ±",cost:25},{emoji:"ğŸ¦Š",cost:30}
];

let coins=Number(localStorage.getItem("coins")||0);
let owned=JSON.parse(localStorage.getItem("ownedSkins")||'["ğŸ¼"]');
let skin=localStorage.getItem("skin")||"ğŸ¼";
document.getElementById("coins").textContent=coins;

let state="menu",bird,pipes,score,gravity=0.6,timer=0;

function startGame(){
hideAll();state="game";
bird={x:canvas.width*.25,y:canvas.height/2,v:0};
pipes=[];score=0;timer=0;
document.getElementById("score").textContent=0;
}
function openShop(){hideAll();shop.style.display="flex";renderShop()}
function backToMenu(){hideAll();menu.style.display="flex";loadScores()}
function hideAll(){menu.style.display=shop.style.display=gameover.style.display="none"}

function gameOver(){
state="gameover";coins+=score;
localStorage.setItem("coins",coins);
document.getElementById("coins").textContent=coins;
document.getElementById("finalScore").textContent=score;
gameover.style.display="flex";
saveScore(score);
}

function renderShop(){
const list=document.getElementById("shopList");list.innerHTML="";
SKINS.forEach(s=>{
const ownedSkin=owned.includes(s.emoji);
const c=document.createElement("div");c.className="card";
c.innerHTML=`${s.emoji}<br>${ownedSkin?"Owned":s.cost+" coins"}`;
const b=document.createElement("button");
b.textContent=ownedSkin?"Equip":"Buy";
b.onclick=()=>{
if(!ownedSkin){
if(coins<s.cost)return alert("Not enough coins");
coins-=s.cost;owned.push(s.emoji);
localStorage.setItem("coins",coins);
localStorage.setItem("ownedSkins",JSON.stringify(owned));
}
skin=s.emoji;localStorage.setItem("skin",skin);
renderShop();
};
c.appendChild(b);list.appendChild(c);
});
}

function spawnPipe(){
const gap=canvas.height*0.3;
const top=Math.random()*(canvas.height-gap-100)+50;
pipes.push({x:canvas.width,top,bottom:top+gap,passed:false});
}

function update(){
if(state!=="game")return;
bird.v+=gravity;bird.y+=bird.v;
if(bird.y<0||bird.y>canvas.height)gameOver();
timer++;if(timer>90){spawnPipe();timer=0}
pipes.forEach(p=>{
p.x-=4;
if(!p.passed&&p.x<bird.x){p.passed=true;score++;document.getElementById("score").textContent=score}
if(bird.x>p.x&&bird.x<p.x+60&&(bird.y<p.top||bird.y>p.bottom))gameOver();
});
pipes=pipes.filter(p=>p.x>-80);
}

function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);
if(state!=="game")return;
ctx.font="32px serif";ctx.fillText(skin,bird.x-16,bird.y);
ctx.fillStyle="#2ecc71";
pipes.forEach(p=>{
ctx.fillRect(p.x,0,60,p.top);
ctx.fillRect(p.x,p.bottom,60,canvas.height);
});
}

function loop(){update();draw();requestAnimationFrame(loop)}loop();
function flap(){if(state==="game")bird.v=-10}
addEventListener("pointerdown",e=>{e.preventDefault();flap()},{passive:false});
addEventListener("keydown",e=>e.code==="Space"&&flap());
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore,collection,addDoc,getDocs,query,orderBy,limit }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyC93SD27hG0qta0n3DaDxGzTvNtm9ePWUM",
authDomain:"flappy-panda-github.firebaseapp.com",
projectId:"flappy-panda-github",
storageBucket:"flappy-panda-github.firebasestorage.app",
messagingSenderId:"685258980565",
appId:"1:685258980565:web:8dbbed1a10de3de30eb65c",
measurementId:"G-2M3S70YDL6"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

window.saveScore=async(score)=>{
if(score>0)await addDoc(collection(db,"scores"),{score,time:Date.now()});
};

window.loadScores=async()=>{
const list=document.getElementById("scores");list.innerHTML="";
const q=query(collection(db,"scores"),orderBy("score","desc"),limit(10));
const snap=await getDocs(q);
snap.forEach(d=>{
const li=document.createElement("li");
li.textContent=d.data().score;
list.appendChild(li);
});
};
loadScores();
</script>

</body>
</html>
