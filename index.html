<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Flappy Panda ğŸ¼</title>
<style>
body{margin:0;font-family:Arial;background:#87CEEB;overflow:hidden}
canvas{display:block}
button{padding:14px 22px;font-size:18px;margin:8px;border-radius:10px;border:none}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center}
#shop{display:none}
#shopContent{background:#222;width:90%;max-height:70%;overflow-y:auto;border-radius:14px;padding:15px}
.skin{font-size:34px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #444;padding:6px}
#leaderboard{background:#222;padding:15px;border-radius:12px;margin-top:20px;width:80%;max-width:300px}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="menu" class="overlay">
<h1>ğŸ¼ Flappy Panda</h1>
<button onclick="startGame()">â–¶ Start</button>
<button onclick="openShop()">ğŸ›’ Shop</button>
<div id="leaderboard"><h3>ğŸ† Wereldwijde Highscores</h3><ol id="scores"></ol></div>
</div>

<div id="shop" class="overlay">
<h2>ğŸ›’ Shop</h2>
<div id="shopContent"></div>
<button onclick="closeShop()">â¬… Terug</button>
</div>

<div id="gameover" class="overlay" style="display:none">
<h2>ğŸ’€ Game Over</h2>
<button onclick="restart()">ğŸ” Opnieuw</button>
<button onclick="backToMenu()">ğŸ  Menu</button>
</div>

<audio id="music" src="background.mp3" loop></audio>

<script>
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
canvas.width=innerWidth;canvas.height=innerHeight;

let playing=false,score=0;
let coins=Number(localStorage.getItem("coins")||0);
let bird=localStorage.getItem("activeSkin")||"ğŸ¼";
let owned=JSON.parse(localStorage.getItem("ownedSkins")||'["ğŸ¼"]');

const skins=[
{emoji:"ğŸ¼",price:0},{emoji:"ğŸµ",price:10},{emoji:"ğŸ¸",price:20},
{emoji:"ğŸ§",price:30},{emoji:"ğŸ±",price:40},{emoji:"ğŸ¦Š",price:50},
{emoji:"ğŸ¶",price:60},{emoji:"ğŸ¯",price:70},{emoji:"ğŸ°",price:80},{emoji:"ğŸ˜¹",price:100}
];

document.body.addEventListener("touchstart",()=>document.getElementById("music").play(),{once:true});

function startGame(){document.getElementById("menu").style.display="none";resetGame();playing=true}
function restart(){document.getElementById("gameover").style.display="none";resetGame();playing=true}
function backToMenu(){document.getElementById("gameover").style.display="none";document.getElementById("menu").style.display="flex";updateLeaderboard()}

function openShop(){
document.getElementById("shop").style.display="flex";
const c=document.getElementById("shopContent");
c.innerHTML=`<h3>ğŸ’° Coins: ${coins}</h3>`;
skins.forEach(s=>{
const d=document.createElement("div");d.className="skin";
d.innerHTML=`<span>${s.emoji} - ${s.price}ğŸ’°</span>`;
const b=document.createElement("button");
if(owned.includes(s.emoji)){
b.textContent="Equip";b.onclick=()=>{bird=s.emoji;localStorage.setItem("activeSkin",bird)}
}else{
b.textContent="Koop";b.disabled=coins<s.price;
b.onclick=()=>{coins-=s.price;owned.push(s.emoji);
localStorage.setItem("coins",coins);
localStorage.setItem("ownedSkins",JSON.stringify(owned));
openShop()}
}
d.appendChild(b);c.appendChild(d);
});
}
function closeShop(){document.getElementById("shop").style.display="none"}

/* FLAPPY GAME */
let y,vel,pipes,frame;
const gravity=0.6,jump=-10;

function resetGame(){y=canvas.height/2;vel=0;pipes=[];frame=0;score=0}

function flap(){if(playing)vel=jump}
document.body.addEventListener("touchstart",flap);
document.body.addEventListener("mousedown",flap);
document.body.addEventListener("keydown",e=>e.code==="Space"&&flap());

function spawnPipe(){
const gap=180;
const top=Math.random()*(canvas.height-gap-100)+50;
pipes.push({x:canvas.width,top,bottom:top+gap,passed:false});
}

function gameOver(){
playing=false;
coins+=score;
localStorage.setItem("coins",coins);
document.getElementById("gameover").style.display="flex";
saveScore(score);updateLeaderboard();
}

function loop(){
ctx.clearRect(0,0,canvas.width,canvas.height);
if(playing){
vel+=gravity;y+=vel;frame++;
if(frame%120===0)spawnPipe();
ctx.font="42px serif";ctx.fillText(bird,80,y);
pipes.forEach(p=>{
p.x-=3;
ctx.fillRect(p.x,0,60,p.top);
ctx.fillRect(p.x,p.bottom,60,canvas.height);
if(!p.passed&&p.x<80){p.passed=true;score++}
if(80<p.x+60&&120>p.x&&(y<p.top||y>p.bottom))gameOver();
});
if(y<0||y>canvas.height)gameOver();
ctx.fillText("Score: "+score,20,50);
}
requestAnimationFrame(loop);
}
loop();
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-analytics.js";
import { getFirestore,collection,addDoc,query,orderBy,limit,getDocs }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyC93SD27hG0qta0n3DaDxGzTvNtm9ePWUM",
authDomain:"flappy-panda-github.firebaseapp.com",
projectId:"flappy-panda-github",
storageBucket:"flappy-panda-github.firebasestorage.app",
messagingSenderId:"685258980565",
appId:"1:685258980565:web:8dbbed1a10de3de30eb65c",
measurementId:"G-2M3S70YDL6"
};

const app=initializeApp(firebaseConfig);
getAnalytics(app);
const db=getFirestore(app);

window.saveScore=async(score)=>{
if(score<=0)return;
await addDoc(collection(db,"scores"),{score,time:Date.now()});
};

window.updateLeaderboard=async()=>{
const list=document.getElementById("scores");
if(!list)return;
list.innerHTML="Laden...";
const q=query(collection(db,"scores"),orderBy("score","desc"),limit(10));
const snap=await getDocs(q);
list.innerHTML="";
snap.forEach(d=>{
const li=document.createElement("li");
li.textContent=d.data().score;
list.appendChild(li);
});
};
updateLeaderboard();
</script>

</body>
</html>

